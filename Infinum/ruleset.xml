<?xml version="1.0"?>
<ruleset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="Infinum" namespace="Infinum" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/squizlabs/PHP_CodeSniffer/master/phpcs.xsd">
    <description>Infinum coding standards for WordPress projects</description>

    <config name="encoding" value="utf-8"/>

    <!-- Check code for cross-version PHP compatibility. -->
    <config name="testVersion" value="7.2-"/>
    <rule ref="PHPCompatibilityWP"/>

    <!-- Exclude certain patterns. -->
    <exclude-pattern>/vendor/*</exclude-pattern>
    <exclude-pattern>/node_modules/*</exclude-pattern>

    <!-- Only check php code, linters are used for checking js and css. -->
    <arg name="extensions" value="php"/>

    <!-- Enable colors in report. -->
    <arg name="colors"/>

    <!-- Add source codes in the report. -->
    <arg value="sp"/>

    <!-- Tabs should represent 2 spaces. -->
    <arg name="tab-width" value="2"/>

    <!-- Run sniffs in parallel for faster results. -->
    <arg name="parallel" value="8"/>

    <!-- Cache results between two calls. -->
    <arg name="cache"/>

    <!-- Check against minimum WP version. -->
    <config name="minimum_supported_wp_version" value="5.0"/>

    <!-- Set minimum supported version for deprecated functions. -->
    <rule ref="WordPress.WP.DeprecatedFunctions">
        <properties>
            <property name="minimum_supported_version" value="5.0"/>
        </properties>
    </rule>

    <!-- Use PSR-12 ruleset: https://www.php-fig.org/psr/psr-12/
         Use PSR-2 ruleset for spacing and naming.
         Use WordPress-Docs for documentation checks. -->
    <rule ref="PSR12"/>
    <rule ref="WordPress-Docs"/>
    <rule ref="WordPress-Extra"/>

    <rule ref="WordPress.PHP.YodaConditions">
        <exclude name="WordPress.PHP.YodaConditions.NotYoda"/>
    </rule>

    <!-- File naming should follow PSR-12, not WPCS. -->
    <rule ref="WordPress.Files.FileName">
        <exclude name="WordPress.Files.FileName.InvalidClassFileName"/>
    </rule>

    <!-- File comment should follow PSR-12, not WPCS. -->
    <rule ref="Squiz.Commenting.FileComment">
        <exclude name="Squiz.Commenting.FileComment.SpacingAfterOpen"/>
    </rule>

    <!-- Braces should follow PSR-12 style not WPCS. -->
    <rule ref="Generic.Classes.OpeningBraceSameLine">
        <exclude name="Generic.Classes.OpeningBraceSameLine.BraceOnNewLine"/>
    </rule>

    <!-- Exclude the array alignment enforcing. -->
    <rule ref="WordPress.Arrays.ArrayIndentation">
        <exclude name="WordPress.Arrays.ArrayIndentation.ItemNotAligned"/>
    </rule>

    <!-- Use tabs, not spaces. -->
    <rule ref="Generic.WhiteSpace.DisallowSpaceIndent"/>

    <rule ref="Generic.WhiteSpace.DisallowTabIndent">
        <exclude name="Generic.WhiteSpace.DisallowTabIndent.TabsUsed"/>
    </rule>

    <!-- Opening brace must follow PSR-12 standard -->
    <rule ref="Generic.Functions">
        <exclude name="Generic.Functions.OpeningFunctionBraceKernighanRitchie"/>
    </rule>

    <!-- Allow short array syntax. -->
    <rule ref="Generic.Arrays">
        <exclude name="Generic.Arrays.DisallowShortArraySyntax"/>
    </rule>

    <!-- Remove aligning the array arrows. -->
    <rule ref="WordPress.Arrays">
        <exclude name="WordPress.Arrays.MultipleStatementAlignment.DoubleArrowNotAligned"/>
        <exclude name="WordPress.Arrays.ArrayIndentation.ItemNotAligned"/>
    </rule>

    <!-- Remove spaces after opening and before closing bracket. -->
    <rule ref="PEAR.Functions.FunctionCallSignature">
        <exclude name="PEAR.Functions.FunctionCallSignature.SpaceAfterOpenBracket"/>
        <exclude name="PEAR.Functions.FunctionCallSignature.SpaceBeforeCloseBracket"/>
    </rule>

    <!-- Remove requiring extra spaces in arrays. -->
    <rule ref="WordPress.Arrays.ArrayDeclarationSpacing">
        <exclude name="WordPress.Arrays.ArrayDeclarationSpacing.NoSpaceAfterArrayOpener"/>
        <exclude name="WordPress.Arrays.ArrayDeclarationSpacing.NoSpaceBeforeArrayCloser"/>
    </rule>

    <!-- Improve code readability by allowing the arguments after function call. -->
    <rule ref="PEAR.Functions.FunctionCallSignature">
        <exclude name="PEAR.Functions.FunctionCallSignature.ContentAfterOpenBracket"/>
        <exclude name="PEAR.Functions.FunctionCallSignature.CloseBracketLine"/>
    </rule>

    <!-- Remove extra spacing inside function declaration and call signature -->
    <rule ref="Squiz.Functions.FunctionDeclarationArgumentSpacing">
        <properties>
            <property name="equalsSpacing" value="1"/>
            <property name="requiredSpacesAfterOpen" value="0"/>
            <property name="requiredSpacesBeforeClose" value="0"/>
        </properties>
    </rule>

    <rule ref="PEAR.Functions.FunctionCallSignature">
        <properties>
            <property name="requiredSpacesAfterOpen" value="0"/>
            <property name="requiredSpacesBeforeClose" value="0"/>
        </properties>
    </rule>

    <!-- Remove requiring extra spaces in control structures (conditionals, loops etc.). -->
    <rule ref="WordPress.WhiteSpace.ControlStructureSpacing">
        <exclude name="WordPress.WhiteSpace.ControlStructureSpacing.NoSpaceAfterOpenParenthesis"/>
        <exclude name="WordPress.WhiteSpace.ControlStructureSpacing.NoSpaceBeforeCloseParenthesis"/>
    </rule>

    <!-- Allow multiple parameters on one line for multi-line function calls. -->
    <rule ref="PEAR.Functions.FunctionCallSignature">
        <properties>
            <property name="allowMultipleArguments" value="true"/>
        </properties>
    </rule>

    <!-- Warn about lines longer than 135 chars, and never error. -->
    <rule ref="Generic.Files.LineLength">
        <properties>
            <property name="lineLimit" value="120"/>
            <property name="absoluteLineLimit" value="0"/>
        </properties>
    </rule>

    <!-- Make this sniff more sensitive to commented out code blocks. -->
    <rule ref="Squiz.PHP.CommentedOutCode">
        <properties>
            <property name="maxPercentage" value="55"/>
        </properties>
    </rule>

</ruleset>
